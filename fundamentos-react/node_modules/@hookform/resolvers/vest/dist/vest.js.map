{"version":3,"file":"vest.js","sources":["../src/vest.ts"],"sourcesContent":["import { toNestError } from '@hookform/resolvers';\nimport { FieldError } from 'react-hook-form';\nimport promisify from 'vest/promisify';\nimport type { VestErrors, Resolver } from './types';\n\nconst parseErrorSchema = (\n  vestError: VestErrors,\n  validateAllFieldCriteria: boolean,\n) => {\n  const errors: Record<string, FieldError> = {};\n  for (const path in vestError) {\n    if (!errors[path]) {\n      errors[path] = { message: vestError[path][0], type: '' };\n    }\n\n    if (validateAllFieldCriteria) {\n      errors[path].types = vestError[path].reduce<Record<number, string>>(\n        (acc, message, index) => (acc[index] = message) && acc,\n        {},\n      );\n    }\n  }\n  return errors;\n};\n\nexport const vestResolver: Resolver =\n  (schema, _, resolverOptions = {}) =>\n  async (values, _context, options) => {\n    const result =\n      resolverOptions.mode === 'sync'\n        ? schema(values)\n        : await promisify(schema)(values);\n\n    return result.hasErrors()\n      ? {\n          values: {},\n          errors: toNestError(\n            parseErrorSchema(\n              result.getErrors(),\n              options.criteriaMode === 'all',\n            ),\n            options.fields,\n          ),\n        }\n      : { values, errors: {} };\n  };\n"],"names":["parseErrorSchema","vestError","validateAllFieldCriteria","errors","path","message","type","types","reduce","acc","index","schema","_","resolverOptions","values","_context","options","result","hasErrors","toNestError","getErrors","criteriaMode","fields","mode","promisify"],"mappings":"gJAKMA,EAAmB,SACvBC,EACAC,GAEA,IAAMC,EAAqC,GAC3C,IAAK,IAAMC,KAAQH,EACZE,EAAOC,KACVD,EAAOC,GAAQ,CAAEC,QAASJ,EAAUG,GAAM,GAAIE,KAAM,KAGlDJ,IACFC,EAAOC,GAAMG,MAAQN,EAAUG,GAAMI,OACnC,SAACC,EAAKJ,EAASK,UAAWD,EAAIC,GAASL,IAAYI,GACnD,KAIN,OAAON,wBAIP,SAACQ,EAAQC,EAAGC,mBAAAA,IAAAA,EAAkB,aACvBC,EAAQC,EAAUC,sBACjBC,GAKN,OAAOA,EAAOC,YACV,CACEJ,OAAQ,GACRX,OAAQgB,cACNnB,EACEiB,EAAOG,YACkB,QAAzBJ,EAAQK,cAEVL,EAAQM,SAGZ,CAAER,OAAAA,EAAQX,OAAQ,4BAfK,SAAzBU,EAAgBU,OACZZ,EAAOG,oBACDU,UAAUb,EAAVa,CAAkBV,aALhC"}